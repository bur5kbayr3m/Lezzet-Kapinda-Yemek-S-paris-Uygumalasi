@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="space-y-6">
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <div class="flex items-center">
                <div class="p-3 bg-blue-100 rounded-full">
                    <i class="fas fa-users text-blue-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Toplam Kullanıcı</p>
                    <p class="text-2xl font-semibold text-gray-900" id="totalUsers">-</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <div class="flex items-center">
                <div class="p-3 bg-green-100 rounded-full">
                    <i class="fas fa-store text-green-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Aktif Mağaza</p>
                    <p class="text-2xl font-semibold text-gray-900" id="totalStores">-</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <div class="flex items-center">
                <div class="p-3 bg-purple-100 rounded-full">
                    <i class="fas fa-shopping-cart text-purple-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Bugünkü Sipariş</p>
                    <p class="text-2xl font-semibold text-gray-900" id="todayOrders">-</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <div class="flex items-center">
                <div class="p-3 bg-yellow-100 rounded-full">
                    <i class="fas fa-dollar-sign text-yellow-600 text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Toplam Gelir</p>
                    <p class="text-2xl font-semibold text-gray-900" id="totalRevenue">-</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Orders -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900">Son Siparişler</h3>
            </div>
            <div class="p-6">
                <div id="recentOrdersContainer" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>Yükleniyor...</p>
                    </div>
                </div>
                <div class="mt-4">
                    <a href="/AdminPanel/Orders" class="text-admin-primary hover:text-admin-secondary text-sm font-medium">
                        Tüm siparişleri görüntüle <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Users -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900">Yeni Kullanıcılar</h3>
            </div>
            <div class="p-6">
                <div id="recentUsersContainer" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>Yükleniyor...</p>
                    </div>
                </div>
                <div class="mt-4">
                    <a href="/AdminPanel/Users" class="text-admin-primary hover:text-admin-secondary text-sm font-medium">
                        Tüm kullanıcıları görüntüle <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Chart -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <h3 class="text-lg font-semibold text-gray-900">Günlük Aktivite</h3>
        </div>
        <div class="p-6">
            <div class="h-64 flex items-center justify-center text-gray-500">
                <div class="text-center">
                    <i class="fas fa-chart-line text-4xl mb-4"></i>
                    <p>Grafik özelliği yakında eklenecek</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    async function loadDashboardData() {
        try {
            // Load users count
            try {
                const users = await adminAPI.getUsers();
                document.getElementById('totalUsers').textContent = users.length;
            } catch (error) {
                document.getElementById('totalUsers').textContent = '0';
            }

            // Load stores count
            try {
                const stores = await adminAPI.getStores();
                document.getElementById('totalStores').textContent = stores.length;
            } catch (error) {
                document.getElementById('totalStores').textContent = '0';
            }

            // Mock data for orders and revenue (since we don't have these endpoints easily accessible)
            document.getElementById('todayOrders').textContent = '12';
            document.getElementById('totalRevenue').textContent = '₺4,250';

            // Load recent orders (mock data)
            loadRecentOrders();
            
            // Load recent users
            loadRecentUsers();

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showError('Dashboard verileri yüklenirken bir hata oluştu.');
        }
    }

    function loadRecentOrders() {
        // Mock recent orders data
        const recentOrders = [
            { id: 1, customer: 'Ahmet Yılmaz', amount: '₺85.50', status: 'Hazırlanıyor', time: '5 dk önce' },
            { id: 2, customer: 'Fatma Kaya', amount: '₺124.00', status: 'Teslim Edildi', time: '15 dk önce' },
            { id: 3, customer: 'Mehmet Demir', amount: '₺67.25', status: 'Yolda', time: '22 dk önce' },
            { id: 4, customer: 'Ayşe Çelik', amount: '₺98.75', status: 'Onaylandı', time: '35 dk önce' }
        ];

        const container = document.getElementById('recentOrdersContainer');
        container.innerHTML = recentOrders.map(order => `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="font-medium text-gray-900">${order.customer}</p>
                    <p class="text-sm text-gray-600">${order.time}</p>
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-900">${order.amount}</p>
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(order.status)}">
                        ${order.status}
                    </span>
                </div>
            </div>
        `).join('');
    }

    async function loadRecentUsers() {
        try {
            const users = await adminAPI.getUsers();
            const recentUsers = users.slice(0, 4); // Get first 4 users

            const container = document.getElementById('recentUsersContainer');
            container.innerHTML = recentUsers.map(user => `
                <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                    <div class="w-10 h-10 bg-admin-primary rounded-full flex items-center justify-center text-white font-semibold">
                        ${user.username.charAt(0).toUpperCase()}
                    </div>
                    <div class="ml-3">
                        <p class="font-medium text-gray-900">${user.username}</p>
                        <p class="text-sm text-gray-600">${user.email}</p>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            const container = document.getElementById('recentUsersContainer');
            container.innerHTML = `
                <div class="text-center py-4 text-gray-500">
                    <p>Kullanıcı bilgileri yüklenemedi</p>
                </div>
            `;
        }
    }

    function getStatusColor(status) {
        switch (status) {
            case 'Hazırlanıyor':
                return 'bg-yellow-100 text-yellow-800';
            case 'Teslim Edildi':
                return 'bg-green-100 text-green-800';
            case 'Yolda':
                return 'bg-blue-100 text-blue-800';
            case 'Onaylandı':
                return 'bg-purple-100 text-purple-800';
            default:
                return 'bg-gray-100 text-gray-800';
        }
    }

    // Load dashboard data on page load
    document.addEventListener('DOMContentLoaded', loadDashboardData);
</script>
}